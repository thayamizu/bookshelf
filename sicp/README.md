計算機プログラムの構造と解釈
====

## 環境の準備
- Visual Studio Code / WSL
- vscode-schemeをインストールしておく
- Scheme処理系として､`Gauche`をインストール
    - WSL上にLinuxbrewをインストールしておけば，brewコマンドからインストールできる．

```sh
$brew install gauche
```

## 手続きによる抽象の構築
計算プロセス(computational process)は計算機における抽象的な存在．このプロセスは，進行しながらもう一つの抽象であるデータ(data)を操作する．プロセスの進行は，プログラムの指示に従う．

プロセスに仕事をさせるため，我々はプログラム言語の記号式で注意深く構成する．

### Lispによるプログラム
- Lispは1950年代の終わり頃，再起方程式（recursion equation）という論理表現についての推論の形式化として __Jhon McCarthy__ によって発明された．

#### 1.1 プログラムの要素
プログラム言語について語るとき，単純が概念を統合して複雑な概念を構成する要素に注意する．これには，次の3つの大きなメカニズムがある．

- 基本式・・・言語が関わる最も単純なもの
- 組合わせ法・・・より単純なものから合成物をつくる
- 抽象化法・・・合成物に名をつけ，単一のものとして扱う

#### 1.1.1 式

SchemeのREPLの導入節

式の並びを括弧で囲んで手続きの作用を表現する式を**組み合わせ**という，並びの左端の要素を*演算子*，他の要素を**被演算子**と呼ぶ

演算子の左側に置く記法を**前置記法**と呼ぶ．前置記法ではその自然な拡張として，**入れ子**を許す．

被演算子が，縦に整列するような記法のことを**清書系**と呼ぶ．


#### 1.1.2 名前と環境

プログラム言語の重要な点は，名前を使って計算オブジェクトを指す手段を用意することである．オブジェクトを値とする変数を識別するものが**名前**となる．

LispのScheme方言では，defineを使って名前をつける

```scheme
(define size 2)
```

そのほかのdefineの例

```scheme
(define pi 3.14159)

(define radius 10)

(* pi 
   (* radius radius))
```

演算の結果を指すのにも，単純な名前を使うことが出来るので我々の言語の最も単純な抽象手段である．

解釈系は，名前とオブジェクトの対を保持するために，何らかの形で記憶している．この記憶を**環境**と呼ぶ．

#### 1.1.3 組み合わせの評価
- Schemeは辛いので此処から先は`JavaScript`で実装する
  - 前置記法は書きづらい

- 組み合わせの評価は次のように行う

1. 組み合わせの部分式の評価

1. 最左部分式の値である手続きを、残りの部分式の値である引数に作用させる。
    - 「最左部分式が値」かどうかは対象となる言語に依存しそう

__評価規則の本質は再帰__ である

評価規則の値が、`上方へ湧き出すような形`を 木構造の溜め込みと呼ぶ。

```js
( 2 + (4 * 6)) * (3 + 5 + 7)
```

基本的な評価ルールとして、以下のようなものを規定しておく

1. 数字列の値は．その表す数値とする．

1. 基本演算子の値は.対応する演算を実行する機械命令の列とする．

1. それ以外の名前の値は．その環境で名前と対応づけられたオブジェクトとする


上記のルールでは、`定義`が規定されていない。例えば次のようなものである。

```js
const x = 3
```

```scheme
(define x 3)
```

これらのルールは、評価規則の例外である。このような評価規則の例外を __特殊形式__ と呼ぶ。


#### 1.1.4 合成手続き

強力なプログラム言語に備わっているべき機能

- 数と算術演算子は基本的データと手続きである。

- 組合せの入れ子は演算を組み合せる手段である。

- 名前と値を対応づける定義は抽象のナイーブな手段である。


さらに強力な抽象化技法である手続き定義(Procedure definition)を学ぶ。これで、手続きと名前を対応づけて指すことのができる。

例として二乗の定義

```js
function square(x) 
{
  return x * x
}
```

`square` という名前の合成手続きの定義ができる。手続きの一般形は次のようになる

```
(define <name> <formal parameters> <body>) 
```

JSでは、


```
function <name>(<formal parameters>) 
{
 <body>
}
```

のような形である。`<name>`は手続きを環境で識別するための名前、`<formal parameters>`は手続き本体の中で手続きの対応する引数を指すための名前である。`<body>`は手続き本体である。

``sh
$node
> square(21)
441
> 
``

#### 1.1.5 手続き作用の置き換えモデル

`sum-of-squares`に　`(+ 5 1)` と `(* 5 2)`を作用させるプロセスを考える。

この組合せ手続きの評価は、`sum-of-square`の`square`手続きを得るため `(+ 5 1)`と`(* 5 2)`を評価し、次の`+`演算子の手続きを得るために、`square`手続きを評価し、最終的に`(+ 36 100)`という計算に簡約され、136が得られる。


```
(sum-of-squares (+5 1) (* 5 2))
↓
(+ (square 6) (square 1O))
↓
(+ 36 100）
↓
136
```


このプロセスを __手続き作用の置換えモデル(Substituion model)__ と呼ぶ。

__作用的順序と正規順序__

- すべて展開して簡約する方法を、__正規順序__

- 引数を評価して作用させる方法を、__作用的順序__

置換えモデルを使って.正しい値が得られる手続き作用については正規順序と作用的順序の評価は同じ値になることが示される。（正規順序と作用的順序の評価が同じ結果にならない「不当な」値の例は問題1.5を参照）